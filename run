#!/usr/bin/env bash
set -e

if [[ $# -lt 1 ]]; then
  echo "Usage: ./run install | ./run test | ./run /absolute/path/to/url_file"
  exit 1
fi

case "$1" in
  install)
    # echo "[stub] Installing dependencies..."
    pip3 install --user -r requirements.txt
    exit 0
    ;;
  test)
    # echo "[stub] Running test suite..."
    # later: pytest with coverage
    python3 run_tests.py
    exit 0
    ;;
  pytest)
    # echo "[stub] Running test suite..."
    # later: pytest with coverage
    pytest --cov=src
    exit 0
    ;;
  *) # absolute path assumed = URL_FILE
    # echo "Running CLIApp(file)..."
    python3 -m src.CLIApp $1
    exit 0
    ;;
  tracks)
    # Return the planned tracks
    echo '{"plannedTracks":["Access control track"]}'
    exit 0
    ;;
  reset)
    # Reset the registry - clear all data
    # This would need to interact with your storage mechanism
    if [ -d "./packages" ]; then
        rm -rf ./packages/*
    fi
    if [ -f "./packages.json" ]; then
        echo "[]" > ./packages.json
    fi
    echo "Registry is reset."
    exit 0
    ;;
esac
